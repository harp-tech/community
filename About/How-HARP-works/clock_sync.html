
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Synchronization Clock &#8212; HARP Documentation 0.0.0 documentation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../_static/harp.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Harp device common registers and operation" href="common_registers_operation_devices.html" />
    <link rel="prev" title="Harp Binary Protocol" href="binary_protocol.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../../index.html">
  <img src="../../_static/harp.png" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../index.html">
  About
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../Devices/devicelist_filter.html">
  Device List
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../Using-HARP/index.html">
  Using HARP
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="index.html">
  Harp Protocols
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
      <div class="navbar-end-item">
        <form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <div class="col-12 col-md-1 col-xl-2 bd-sidebar no-sidebar"></div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-11 col-xl-8 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <section id="synchronization-clock">
<h1>Synchronization Clock<a class="headerlink" href="#synchronization-clock" title="Permalink to this headline">#</a></h1>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#introduction" id="id1">1. Introduction</a></p></li>
<li><p><a class="reference internal" href="#serial-configuration" id="id2">2. Serial configuration</a></p></li>
<li><p><a class="reference internal" href="#physical-connection" id="id3">4. Physical connection</a></p></li>
</ul>
</div>
<p>One of the most important features of Harp is the ability of all Harp devices to share the same clock. Because any registered event is timestamped on the same clock, the temporal sequence of events is accurately determined even if events are detected by different devices.</p>
<section id="introduction">
<h2><a class="toc-backref" href="#id1">1. Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">#</a></h2>
<p>The Harp Synchronization Clock is a bus that disseminates the actual current time to Harp devices.
It’s a serial communication containing the time information. Each device uses the last byte of the
transmission to align themselves with the current time.</p>
</section>
<section id="serial-configuration">
<h2><a class="toc-backref" href="#id2">2. Serial configuration</a><a class="headerlink" href="#serial-configuration" title="Permalink to this headline">#</a></h2>
<p>Baud rate used is 100 kbps.</p>
<p>The last byte starts <strong>exactly</strong> 672 us before the elapse of the current second (picture below).</p>
<p>The packet is composed of 6 bytes (header[2] and timestamp_s[4])
- header[2] = {0xAA, 0xAF)
- The timestamp_s is of type uint32 little-endian and contains the current second</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>IMPORTANT</p>
<p>Since there’s no checksum to validate the packet, the sender must make sure that, if the header sequence is present in the, the packet is not sent.</p>
</div>
<p>3. Example code
Example of a microcontroller C code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ISR</span><span class="p">(</span><span class="n">TCD0_OVF_vect</span><span class="p">,</span> <span class="n">ISR_NAKED</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">((</span><span class="o">*</span><span class="n">timestamp_byte0</span> <span class="o">==</span> <span class="mh">0xAA</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">*</span><span class="n">timestamp_byte1</span> <span class="o">==</span> <span class="mh">0xAF</span><span class="p">))</span> <span class="n">reti</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">((</span><span class="o">*</span><span class="n">timestamp_byte1</span> <span class="o">==</span> <span class="mh">0xAA</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">*</span><span class="n">timestamp_byte2</span> <span class="o">==</span> <span class="mh">0xAF</span><span class="p">))</span> <span class="n">reti</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">((</span><span class="o">*</span><span class="n">timestamp_byte2</span> <span class="o">==</span> <span class="mh">0xAA</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">*</span><span class="n">timestamp_byte3</span> <span class="o">==</span> <span class="mh">0xAF</span><span class="p">))</span> <span class="n">reti</span><span class="p">();</span>

        <span class="n">switch</span> <span class="p">(</span><span class="n">timestamp_tx_counter</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">case</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">USARTD1_DATA</span> <span class="o">=</span> <span class="mh">0xAA</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">USARTD1_DATA</span> <span class="o">=</span> <span class="mh">0xAF</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">USARTD1_DATA</span> <span class="o">=</span> <span class="o">*</span><span class="n">timestamp_byte0</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="mi">6</span><span class="p">:</span>
            <span class="n">USARTD1_DATA</span> <span class="o">=</span> <span class="o">*</span><span class="n">timestamp_byte1</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="mi">7</span><span class="p">:</span>
            <span class="n">USARTD1_DATA</span> <span class="o">=</span> <span class="o">*</span><span class="n">timestamp_byte2</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="mi">1998</span><span class="p">:</span>
            <span class="n">USARTD1_DATA</span> <span class="o">=</span> <span class="o">*</span><span class="n">timestamp_byte3</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>
</div>
</section>
<section id="physical-connection">
<h2><a class="toc-backref" href="#id3">4. Physical connection</a><a class="headerlink" href="#physical-connection" title="Permalink to this headline">#</a></h2>
<p>The physical connection is made by a simple audio cable.</p>
<p>The connector used is from Switchcraft Inc. and has the part number 35RASMT2BHNTRX</p>
</section>
</section>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="binary_protocol.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Harp Binary Protocol</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="common_registers_operation_devices.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Harp device common registers and operation</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2010-2022, Open Ephys &amp; Contributors.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.5.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>